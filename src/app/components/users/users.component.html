<div class="d-flex flex-row justify-content-center container">
  <ul class="nav nav-tabs mt-5 flex-column col-md-3 align-self-start">
    <li class="nav-item">
      <a class="nav-link text-dark" data-toggle="tab" (click)="showTab('users')"
        [ngClass]="{'active': currentTab === 'users'}">Users</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-dark" data-toggle="tab" (click)="showTab('tournaments')"
        [ngClass]="{'active': currentTab === 'tournaments'}">Tournoi(s)</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-dark" data-toggle="tab" (click)="showTab('tournamentRegistrations')"
        [ngClass]="{'active': currentTab === 'tournamentRegistrations'}">Inscription au(x) tournoi(s)</a>
    </li>
  </ul>
  <div class="tab-content col-md-8 m-5">
    <div *ngIf="currentTab === 'users'" id="tab1">
      <div class="container">
        <div class="col-md-1 mb-1 offset-11">
          <select class="form-select" (change)="onElementsPerPageChange($event)">
            <option value="10" [selected]="elementsPerPage === 10">10</option>
            <option value="20" [selected]="elementsPerPage === 20">20</option>
            <option value="50" [selected]="elementsPerPage === 50">50</option>
          </select>
        </div>
        <div class="row">
          <div class="col">
            <table class="table table-bordered table-striped text-center">
              <thead>
                <tr>
                  <th>Email</th>
                  <th>Pseudo</th>
                  <th>Prénom</th>
                  <th>Nom</th>
                  <th>Créé le</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users">
                  <td class="align-middle">{{ user.email }}</td>
                  <td class="align-middle">{{ user.pseudo }}</td>
                  <td class="align-middle">{{ user.firstName }}</td>
                  <td class="align-middle">{{ user.lastName }}</td>
                  <td class="align-middle">{{ user.createdAt | date }}</td>
                  <td>
                    <button class="btn btn-warning mx-1" (click)="onModify(user)">Modifier</button>
                    <button *ngIf="user.deletedAt === null" class="btn btn-danger mx-1"
                      (click)="confirmDeleteUser(user)">Supprimer</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="d-flex flex-row justify-content-between">
          <button class="btn btn-outline-dark" (click)="onPreviousPage()"
            [disabled]="currentPage === 1">Précédent</button>
          <button class="btn btn-outline-dark" (click)="onNextPage()" [disabled]="currentPage === totalOfPages"
            [disabled]="totalOfPages === 1">Suivant</button>
        </div>
      </div>

      <ng-template #deleteConfirmation let-modal>
        <div class="modal-header">
          <h5 class="modal-title">Confirmer à supprimer</h5>
          <button type="button" class="close" (click)="modal.dismiss('Cross click')" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Vous êtes sûr de vouloir supprimer cet utilisateur (email: {{ selectedUser?.email }})?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" (click)="deleteUser(selectedUser)" [disabled]="submitted">Supprimer</button>
          <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Close click')">Annuler</button>
        </div>
      </ng-template>

      <ng-template #deleteInfo let-modal>
        <div class="modal-header">
          <h5 class="modal-title">Utilisateur est supprimé</h5>
          <button type="button" class="close" (click)="modal.dismiss('Cross click')" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>L'utilisateur a été supprimé avec succès.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Close')">Fermer</button>
        </div>
      </ng-template>
    </div>
    <div *ngIf="currentTab === 'tournaments'" id="tab2">
      <div class="row justify-content-center">
        <div class="" *ngFor="let tournament of tournaments">
          <div class="card mb-3">
            <div class="card-body text-center">
              <h5 class="card-title">{{ tournament.name }}</h5>
              <p class="card-text">Date de début le {{ tournament.startingDate | date }}</p>
              <p class="card-text">Date de fin le {{ tournament.endingDate | date }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="currentTab === 'tournamentRegistrations'" id="tab3">
      <div class="row justify-content-center">
        <div *ngIf="message"
          [ngClass]="{ 'alert': true, 'alert-success': isError === false, 'alert-danger': isError === true}">
          {{ message }}
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col">
          <table class="table table-bordered table-striped text-center">
            <thead>
              <tr>
                <th class="align-middle">User</th>
                <th class="align-middle">Tournoi</th>
                <th class="align-middle">Statut</th>
                <th class="align-middle">Date d'inscription</th>
                <th class="align-middle">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let tournamentRegistration of tournamentRegistrations">
                <td class="align-middle">{{ tournamentRegistration.userEmail}}</td>
                <td class="align-middle">{{ tournamentRegistration.tournamentName }}</td>
                <td class="align-middle">{{ tournamentRegistration.status }}</td>
                <td class="align-middle">{{ tournamentRegistration.createdAt | date }}</td>
                <td>
                  <button *ngIf="tournamentRegistration.status === 'pending'" class="btn btn-success mx-1"
                    (click)="accept(tournamentRegistration)">Accepter</button>
                  <button *ngIf="tournamentRegistration.status === 'pending'" class="btn btn-danger mx-1"
                    (click)="refuse(tournamentRegistration)">Refuser</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>